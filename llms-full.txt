# FuyuBot (/docs)

# FuyuBot

ä¸€ä¸ªåŸºäº [Node.js](https://nodejs.org/zh-cn) + TypeScript + [TDLib](https://core.telegram.org/tdlib/docs/index.html) çš„ç°ä»£åŒ– Telegram Bot æ¡†æ¶ï¼Œæ”¯æŒæ’ä»¶åŒ–æ‰©å±•ï¼Œå…¼å®¹ Bot è´¦å· ä¸ ç”¨æˆ·è´¦å·ï¼ˆè‡ªèµ°äººå½¢ï¼‰

<Callout title="æ³¨æ„" type="warn">
  æœ¬é¡¹ç›®ä½¿ç”¨äº† Node.js å®éªŒæ€§åŠŸèƒ½ `--experimental-loader`ï¼Œå…¶è¡Œä¸ºå¯èƒ½éš Node
  ç‰ˆæœ¬æ›´æ”¹ã€‚
</Callout>

## è¯´æ˜

### é¡¹ç›®ç®€ä»‹

âœ¨ ç‰¹æ€§ï¼š

* ğŸš€ åŸºäº **TDLib**ï¼Œæ”¯æŒåŸå§‹è°ƒç”¨åŠŸèƒ½é½å…¨
* ğŸ§© **æ’ä»¶ç³»ç»Ÿ**ï¼Œæ¨¡å—åŒ–æ‰©å±•
* ğŸ‘¥ æ”¯æŒ **Bot è´¦å·** ä¸ **ç”¨æˆ·è´¦å·ï¼ˆè‡ªèµ°äººå½¢ï¼‰**
* ğŸ”§ ç°ä»£åŒ–å¼€å‘ï¼šESM + TypeScript
* ğŸ› ï¸ [æ’ä»¶å¼€å‘æ–‡æ¡£](/docs/plugin)

### ğŸ“¦ å®‰è£…éœ€æ±‚

åœ¨ä½¿ç”¨å‰ï¼Œè¯·ç¡®ä¿å·²å®‰è£…ä»¥ä¸‹ä¾èµ–ç¯å¢ƒï¼š

* **Node.js v22.6.0** ä»¥ä¸Šå³å¯
* **pnpm**(æ¨èï¼Œäº¦å¯ä½¿ç”¨ npm/yarn)
* **MongoDB**(æ¨èä½¿ç”¨ [MongoDB Community Server](https://www.mongodb.com/try/download/community),ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±çš„`MongoDB Server`)

å¦‚æœä½ æƒ³è¿œç¨‹è®¿é—® MongoDB è¯·åŠ¡å¿…å¼€å¯ **MongoDB ç”¨æˆ·è®¤è¯**,
æ•°æ®åº“ GUI è®¿é—® desktop: [MongoDB Compass](https://www.mongodb.com/try/download/compass)
Android: [Mongodb](https://github.com/vedfi/mondroid)

### ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/CatMoeCircle/Fuyu_TDBot.git
cd Fuyu_TDBot

# å®‰è£…ä¾èµ–
pnpm install -P

# å¯åŠ¨
pnpm start
```

æŠ€æœ¯æ ˆ

* [TDLib](https://core.telegram.org/tdlib) - Telegram Database Library
* [tdl](https://github.com/eilvelia/tdl) - TDLib çš„ JavaScript åŒ…è£…å™¨
* [prebuilt-tdlib](https://github.com/eilvelia/tdl/blob/main/packages/prebuilt-tdlib/README.md) - é¢„æ„å»ºçš„ TDLib åº“
* [systeminformation](https://www.npmjs.com/package/systeminformation) - è·å–ç³»ç»Ÿä¿¡æ¯
* [mongodb](https://github.com/mongodb/node-mongodb-native) - MongoDB driver
* [axios](https://axios-http.com/) - ç½‘ç»œè¯·æ±‚å·¥å…·
* [cron](https://github.com/kelektiv/node-cron#readme) - å®šæ—¶ä»»åŠ¡


# ä»‹ç» (/docs/1.start)

<GithubInfo owner="CatMoeCircle" repo="Fuyu_TDBot" />

## ä»‹ç»

Fuyu-TDBot æ˜¯ä¸€ä¸ªä½¿ç”¨ TypeScript ç¼–å†™çš„ TG æœºå™¨äººæ¡†æ¶ï¼Œä½¿ç”¨ [TDLib](https://core.telegram.org/tdlib) ä¸ Telegram è¿›è¡Œäº¤äº’ã€‚
[TDLib](https://core.telegram.org/tdlib) æä¾›äº†å‡ ä¹å®Œæ•´çš„ Telegram API åŠŸèƒ½ï¼Œä¸”æ–¹ä¾¿å¼€å‘ï¼Œ
å› æ­¤æœ¬æ¡†æ¶å¯ä»¥ç™»å½• `æ™®é€šè´¦å·` å’Œ `Bot è´¦å·`

## ç‰¹æ€§

* ä½¿ç”¨ TypeScript ç¼–å†™ï¼Œç±»å‹å®‰å…¨ï¼Œå¼€å‘ä½“éªŒè‰¯å¥½
* åŸºäº TDLibï¼Œæ”¯æŒæ™®é€šè´¦å·å’Œ Bot è´¦å·
* æ”¯æŒ æ’ä»¶åŒ–æ‰©å±•ï¼Œæ–¹ä¾¿æ·»åŠ æ–°åŠŸèƒ½
* æä¾›TDLib çš„ API å°è£…ï¼Œç®€åŒ–å¼€å‘æµç¨‹
* å†…ç½®å¤šç§å®ç”¨åŠŸèƒ½æ’ä»¶ï¼Œå¦‚è‡ªåŠ¨å›å¤ã€ç¾¤ç®¡ç†ç­‰

<Callout title="æ³¨æ„" type="warn">
  æœ¬é¡¹ç›®ä½¿ç”¨äº† Node.js å®éªŒæ€§åŠŸèƒ½ `--experimental-loader`ï¼Œå…¶è¡Œä¸ºå¯èƒ½éš Node
  ç‰ˆæœ¬æ›´æ”¹ã€‚
</Callout>

## Telegram Database Library

[TDLib](https://core.telegram.org/tdlib)ï¼ˆTelegram æ•°æ®åº“åº“ï¼‰æ˜¯ä¸€ä¸ªè·¨å¹³å°ã€åŠŸèƒ½é½å…¨çš„ Telegram å®¢æˆ·ç«¯å®ä¾‹ã€‚

* **è·¨å¹³å°**ã€‚TDLib å¯åœ¨ Androidã€iOSã€Windowsã€macOSã€Linuxã€WebAssemblyã€FreeBSDã€Windows Phoneã€watchOSã€tvOSã€Tizenã€Cygwin ä¸Šä½¿ç”¨ã€‚å®ƒè¿˜åº”è¯¥åœ¨å…¶ä»– \*nix ç³»ç»Ÿä¸Šå·¥ä½œï¼Œæ— è®ºæ˜¯å¦ä»˜å‡ºæœ€å°çš„åŠªåŠ›ã€‚
* **å¤šè¯­è¨€**ã€‚TDLib å¯ä»¥è½»æ¾åœ°ä¸ä»»ä½•èƒ½å¤Ÿæ‰§è¡Œ C å‡½æ•°çš„ç¼–ç¨‹è¯­è¨€ä¸€èµ·ä½¿ç”¨ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å…·æœ‰ä¸ Javaï¼ˆä½¿ç”¨ JNIï¼‰å’Œ C#ï¼ˆä½¿ç”¨ C++/CLIï¼‰çš„æœ¬æœºç»‘å®šã€‚
* **æ˜“äºä½¿ç”¨**\*ã€‚TDLib è´Ÿè´£æ‰€æœ‰ç½‘ç»œå®æ–½ç»†èŠ‚ã€åŠ å¯†å’Œæœ¬åœ°æ•°æ®å­˜å‚¨ã€‚
* **é«˜æ€§èƒ½**ã€‚åœ¨ Telegram Bot API ä¸­ï¼Œæ¯ä¸ª TDLib å®ä¾‹åŒæ—¶å¤„ç†è¶…è¿‡ 24,000 ä¸ªæ´»è·ƒçš„æœºå™¨äººã€‚
* **æœ‰æ®å¯æŸ¥**ã€‚æ‰€æœ‰ TDLib API æ–¹æ³•å’Œå…¬å…±æ¥å£éƒ½æœ‰å®Œæ•´çš„æ–‡æ¡£ã€‚
* **ä¸€è‡´**ã€‚TDLib ä¿è¯æ‰€æœ‰æ›´æ–°éƒ½å°†æŒ‰æ­£ç¡®çš„é¡ºåºäº¤ä»˜ã€‚
* **å¯é **ã€‚TDLib åœ¨ç¼“æ…¢ä¸”ä¸å¯é çš„äº’è”ç½‘è¿æ¥ä¸Šä¿æŒç¨³å®šã€‚
* **å®‰å…¨**ã€‚æ‰€æœ‰æœ¬åœ°æ•°æ®éƒ½ä½¿ç”¨ç”¨æˆ·æä¾›çš„åŠ å¯†å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚
* **å®Œå…¨å¼‚æ­¥**ã€‚å¯¹ TDLib çš„è¯·æ±‚ä¸ä¼šç›¸äº’é˜»æ­¢æˆ–å…¶ä»–ä»»ä½•å†…å®¹ï¼Œå“åº”å°†åœ¨å¯ç”¨æ—¶å‘

<Callout title="æ³¨æ„" type="warn">
  æœ¬éƒ¨åˆ†å†…å®¹æ‘˜è‡ª [TDLib å®˜æ–¹æ–‡æ¡£](https://core.telegram.org/tdlib)ï¼Œå¦‚æœ‰ç¿»è¯‘ä¸å‡†ç¡®ä¹‹å¤„è¯·ä»¥å®˜æ–¹æ–‡æ¡£ä¸ºå‡†ã€‚
</Callout>

## MongoDB

Fuyu-TDBot ä½¿ç”¨ MongoDB ä½œä¸ºé»˜è®¤çš„æ•°æ®å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚MongoDB æ˜¯ä¸€ä¸ªåŸºäºæ–‡æ¡£çš„ NoSQL æ•°æ®åº“ï¼Œå…·æœ‰é«˜æ€§èƒ½ã€å¯æ‰©å±•æ€§å’Œçµæ´»çš„æ•°æ®æ¨¡å‹ï¼Œé€‚åˆå­˜å‚¨å’Œç®¡ç†å¤§é‡çš„éç»“æ„åŒ–æ•°æ®ã€‚

## ç¤¾åŒºä¸æ”¯æŒ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨ Fuyu-TDBot æ—¶é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæˆ–è€…æœ‰ä»»ä½•å»ºè®®å’Œåé¦ˆï¼Œæ¬¢è¿åŠ å…¥æˆ‘ä»¬çš„ç¤¾åŒºè¿›è¡Œäº¤æµå’Œè®¨è®ºï¼š

* [GitHub è®¨è®ºåŒº](https://github.com/CatMoeCircle/Fuyu_TDBot/discussions)
* [Telegram é¢‘é“](https://t.me/CatMoeCircle)

æˆ‘ä»¬æœŸå¾…æ‚¨çš„å‚ä¸ï¼Œå…±åŒæ¨åŠ¨ Fuyu-TDBot çš„å‘å±•ï¼


# å¿«é€Ÿå¼€å§‹ (/docs/1.start/quickstart)

## å¿«é€Ÿå¼€å§‹

<Callout title="å‰ææ¡ä»¶" type="success">
  * ç†Ÿæ‚‰å‘½ä»¤è¡Œ
  * å·²å®‰è£… `Git`
  * å·²å®‰è£… [Node.js](https://nodejs.org/) `v22.6.0` æˆ–æ›´é«˜ç‰ˆæœ¬
  * å·²å®‰è£… [MongoDB](https://www.mongodb.com/) å¹¶æ­£åœ¨è¿è¡Œ / æˆ–ä½¿ç”¨è¿œç¨‹çš„ MongoDB æœåŠ¡
  * å·²åˆ›å»º Telegram è´¦å·ï¼ˆæ™®é€šè´¦å·æˆ– Bot è´¦å·å‡å¯ï¼‰
  * å·²è·å– Telegram API ID å’Œ API Hashï¼Œè·å–æ–¹æ³•è¯·å‚è€ƒ [Telegram å®˜æ–¹æ–‡æ¡£](https://core.telegram.org/api/obtaining_api_id#obtaining-api-id)
</Callout>

åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•åœ¨æœ¬åœ°æ­å»º Fuyu-TDBotï¼Œå¹¶è¿è¡Œä¸€ä¸ªç®€å•çš„æœºå™¨äººå®ä¾‹ã€‚

ç¡®ä¿ä½ å®‰è£…äº†æœ€æ–°ç‰ˆæœ¬çš„ Node.jsï¼Œå¹¶ä¸”ä½ çš„å½“å‰å·¥ä½œç›®å½•æ­£æ˜¯æ‰“ç®—åˆ›å»ºé¡¹ç›®çš„ç›®å½•ã€‚

é¦–å…ˆä½ éœ€è¦å®‰è£… pnpmï¼ˆå¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…çš„è¯ï¼‰ï¼š

<Tabs defaultValue="npm">
  <TabsList>
    <TabsTrigger value="npm">
      <svg viewBox="0 0 27.23 27.23" aria-hidden="true">
        <rect fill="#333333" width="27.23" height="27.23" rx="2" />

        <polygon fill="#fff" points="5.8 21.75 13.66 21.75 13.67 9.98 17.59 9.98 17.58 21.76 21.51 21.76 21.52 6.06 5.82 6.04 5.8 21.75" />
      </svg>

      npm
    </TabsTrigger>
  </TabsList>

  <TabsContent value="npm">
    npm install -g pnpm
  </TabsContent>
</Tabs>

æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ git å…‹éš† Fuyu-TDBot ä»“åº“ï¼š

```bash
git clone https://github.com/CatMoeCircle/Fuyu_TDBot.git
cd Fuyu_TDBot

# ç„¶åï¼Œå®‰è£…é¡¹ç›®ä¾èµ–
pnpm install -P

# æ¥ä¸‹æ¥ï¼Œè¿è¡Œbotåˆå§‹åŒ–
pnpm start
```

ç¬¬ä¸€æ¬¡å¯åŠ¨åï¼Œä¼šåˆå§‹åŒ–é…ç½®æ–‡ä»¶ï¼Œå¹¶æç¤ºä½ è¾“å…¥å¿…è¦çš„ä¿¡æ¯ï¼š

```bash
âœ” è¯·è¾“å…¥ TG_API_ID <your_api_id>
âœ” è¯·è¾“å…¥ TG_API_HASH <your_api_hash>
# åœ¨MONGODB_URLçš„ç»“å°¾ä¸­æ·»åŠ æ•°æ®åº“åç§°ï¼Œ
# [!code word:fuyu-tdbot]
# ä¾‹å¦‚ï¼šmongodb://localhost:27017/fuyu-tdbot å¯ä»¥æŒ‡å®šæ•°æ®åº“åç§°ä¸º fuyu-tdbot
# é»˜è®¤æƒ…å†µä¸‹æ²¡æœ‰åˆ™ä¸º fuyubot
âœ” è¯·è¾“å…¥ MONGODB_URL <your_mongodb_url>

âœ” è¯·é€‰æ‹©ç™»å½•çš„è´¦æˆ·ç±»å‹ Bot | User
âœ” è¯·è¾“å…¥ Bot Token <your_bot_token>

[2025-10-21 16:27:41] INFO: Bot å·²ç™»å½•: Botåç§° (@BotUsername - ID: BotID)

```

## é€šè¿‡ PM2 åå°è¿è¡Œ

### PM2 è¿›ç¨‹å®ˆæŠ¤

å¦‚æœä½ å¸Œæœ›åœ¨åå°è¿è¡Œ Fuyu-TDBotï¼Œå¯ä»¥ä½¿ç”¨ PM2 è¿›è¡Œè¿›ç¨‹å®ˆæŠ¤ã€‚

<Callout title="æ³¨æ„" type="warn">
  ä½¿ç”¨å‰è¯·ç¡®ä¿ä½ å·²ç»å®Œæˆäº†ä¸Šè¿°çš„åˆå§‹åŒ–æ­¥éª¤ï¼Œå¹¶ç™»å½•äº†è´¦æˆ·
</Callout>

```bash
# å¯åŠ¨
pnpm pm2:start
# åœæ­¢
pnpm pm2:stop
# é‡å¯
pnpm pm2:restart
# æŸ¥çœ‹æ—¥å¿—
pnpm pm2:logs

```


# å¸¸è§é—®é¢˜æ’æŸ¥ (/docs/2.plugin/2)

## å¸¸è§é—®é¢˜æ’æŸ¥

* **æœªè¢«åŠ è½½**ï¼šç¡®è®¤æ–‡ä»¶/æ–‡ä»¶å¤¹æœªä»¥ `.` å¼€å¤´ä¸”ä¸ä¸º `node_modules`ã€‚
* **ç¼ºå°‘é»˜è®¤å¯¼å‡º**ï¼šç¡®ä¿ `export default` çš„ç±»ç»§æ‰¿è‡ª `Plugin`ã€‚
* **å‘é€æ¶ˆæ¯åªå‡ºç°ä¸´æ—¶æ¶ˆæ¯**ï¼šéœ€è¦ç›‘å¬ `updateMessageSendSucceeded` è·å–æ­£å¼æ¶ˆæ¯ã€‚
* **è°ƒç”¨åŸç”Ÿ TDLib æ–¹æ³•å¤±è´¥**ï¼šå‚è€ƒ [TDLib Function æ–‡æ¡£](https://core.telegram.org/tdlib/docs/classtd_1_1td__api_1_1_function.html)ã€‚

***

å¦‚éœ€æ›´å¤šç¤ºä¾‹æˆ–æƒ³è¦æ‰©å±•æ’ä»¶æ¡†æ¶ï¼Œæ¬¢è¿åœ¨ä»“åº“æå‡º Issue æˆ– PRã€‚ç¥å¼€å‘é¡ºåˆ©ï¼


# æ’ä»¶å¼€å‘çº¦å®š (/docs/2.plugin)

# æ’ä»¶è§„åˆ™

* æ˜ç™½æ’ä»¶è¢« `PluginManager` è¯†åˆ«çš„è§„åˆ™ï¼›
* å®ç°å¿…éœ€çš„æ¥å£ä¸ç”Ÿå‘½å‘¨æœŸï¼›
* æ³¨å†Œå‘½ä»¤ã€æ›´æ–°å¤„ç†å™¨ä»¥åŠå¯é€‰çš„å®šæ—¶/æ‰‹åŠ¨è¿è¡Œä»»åŠ¡ï¼›
* å€ŸåŠ©é¡¹ç›®æä¾›çš„ TDLib å°è£…å‡½æ•°æå‡å¼€å‘æ•ˆç‡ã€‚

## 1. æ’ä»¶åŠ è½½çº¦å®š

* **é»˜è®¤ç›®å½•**ï¼š`PluginManager` ä¼šæ‰«æ `./plugins` çš„é¡¶å±‚æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ã€‚

* **å¯¼å‡ºè¦æ±‚**ï¼šæ¯ä¸ªæ’ä»¶å¿…é¡»é»˜è®¤å¯¼å‡ºä¸€ä¸ªç»§æ‰¿è‡ª `Plugin` çš„ç±»ï¼Œä¾‹å¦‚ï¼š

  ```ts
  import { Plugin } from "@plugin/BasePlugin.ts";

  export default class MyPlugin extends Plugin {}
  ```

* **æ„é€ å‡½æ•°ç­¾å**ï¼š`constructor(client: Client)`ï¼Œå…¶ä¸­ `client` æ˜¯è·å–å½“å‰è¿è¡Œçš„ TDLib å®¢æˆ·ç«¯å®ä¾‹ã€‚

* **å…¥å£æ ¼å¼**ï¼š
  * é¡¶å±‚ `.ts` æ–‡ä»¶ï¼Œä¾‹å¦‚ `plugins/foo.ts`ï¼›ï¼ˆç”¨äºå•æ–‡ä»¶æ’ä»¶ï¼‰
  * æˆ–ç›®å½•å†…çš„ `index.ts`ï¼Œå¦‚ `plugins/bar/index.ts`ã€‚

### 1.1 ç‰¹æ®ŠæŸ¥è¯¢å¯¼å…¥

æ’ä»¶ä¸­å¯ç›´æ¥ä½¿ç”¨è‡ªå®šä¹‰ loader æš´éœ²çš„æŸ¥è¯¢å‚æ•°ï¼š

| æŸ¥è¯¢      | è¯´æ˜           | å…¸å‹ç”¨é€”               |
| ------- | ------------ | ------------------ |
| `?file` | è¿”å›æ–‡ä»¶çš„ç»å¯¹è·¯å¾„å­—ç¬¦ä¸² | ä¼ é€’ç»™æœ¬åœ° APIã€åŸç”Ÿä¸Šä¼ ç­‰    |
| `?raw`  | è¿”å›æ–‡ä»¶å†…å®¹æ–‡æœ¬     | åµŒå…¥æ¨¡æ¿ã€Markdownã€JSON |

ç¤ºä¾‹ï¼š

```ts
import filePath from "../assets/logo.png?file";
import readmeText from "../README.md?raw";
```

### 1.2 è·¯å¾„åˆ«åå¯¼å…¥

é¡¹ç›®é…ç½®äº†å¤šä¸ªè·¯å¾„åˆ«åæ¥ç®€åŒ–å¯¼å…¥è·¯å¾„ï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€‚æ— è®ºä½ åœ¨é¡¹ç›®çš„å“ªä¸ªä½ç½®ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¿™äº›åˆ«åè¿›è¡Œç»å¯¹è·¯å¾„å¯¼å…¥ï¼š

| åˆ«å            | å®é™…è·¯å¾„           | ç”¨é€”è¯´æ˜        |
| ------------- | -------------- | ----------- |
| `@log/*`      | `./log/*`      | æ—¥å¿—ç›¸å…³æ¨¡å—      |
| `@plugin/*`   | `./plugin/*`   | æ’ä»¶ç›¸å…³å·¥å…·å’Œç±»å‹   |
| `@TDLib/*`    | `./TDLib/*`    | TDLib å°è£…å’Œæ¥å£ |
| `@type/*`     | `./types/*`    | å…±äº«ç±»å‹å®šä¹‰      |
| `@function/*` | `./function/*` | é€šç”¨å‡½æ•°åº“       |
| `@db/*`       | `./Database/*` | æ•°æ®åº“ç›¸å…³æ¨¡å—     |

#### ä½¿ç”¨ç¤ºä¾‹

```ts
import logger from "@log/index.ts";
import { Plugin } from "@plugin/BasePlugin.ts";

// å¯¼å…¥ TDLib å·¥å…·
import { sendMessage } from "@TDLib/function/message.ts";

// å¯¼å…¥æ•°æ®åº“
import { getDatabase } from "@db/index.ts";
```

***


# å¯ç”¨å‘½ä»¤ (/docs/1.start/cmd)

## è§¦å‘æ–¹å¼

Fuyu-TDBot æ”¯æŒé€šè¿‡ä»¥ä¸‹æ¶ˆæ¯å¼€å¤´è§¦å‘å‘½ä»¤ï¼š

åœ¨æ¶ˆæ¯å¼€å¤´é»˜è®¤ä½¿ç”¨`/`, `!`, `ï¼`, `.`ï¼Œ`~`ï¼Œ`^` ä½œä¸ºå‰ç¼€ï¼Œä¾‹å¦‚ `/start` æˆ– `!help`ã€‚

### ä¿®æ”¹å‰ç¼€

æ‚¨å¯ä»¥é€šè¿‡configå‘½ä»¤ä¿®æ”¹å‰ç¼€ï¼š
ä½¿ç”¨ ç©ºæ ¼ åˆ†éš”å¤šä¸ªå‰ç¼€

```plaintext
/config set PREFIXES / ! . 
```

## è‡ªå¸¦å‘½ä»¤

Fuyu-TDBot æ”¯æŒä»¥ä¸‹å‘½ä»¤ï¼š

| å‘½ä»¤          | æè¿°            | æƒé™   | å¯å›åº”åœºæ™¯ |
| ----------- | ------------- | ---- | ----- |
| `/start`    | startå‘½ä»¤       | æ‰€æœ‰ç”¨æˆ· | å…¨éƒ¨    |
| `/help`     | å¸®åŠ©å‘½ä»¤ åˆ—å‡ºæ‰€æœ‰å¯ç”¨å‘½ä»¤ | æ‰€æœ‰ç”¨æˆ· | å…¨éƒ¨    |
| `/log`      | è·å–æ—¥å¿—æ–‡ä»¶        | ç®¡ç†å‘˜  | å…¨éƒ¨    |
| `/config`   | é…ç½®ç®¡ç†          | ç®¡ç†å‘˜  | å…¨éƒ¨    |
| `/plugin`   | æ’ä»¶ç®¡ç†å‘½ä»¤        | ç®¡ç†å‘˜  | å…¨éƒ¨    |
| `/setadmin` | è®¾ç½®ç®¡ç†å‘˜         | ä¸»äºº   | å…¨éƒ¨    |

## æ³¨æ„äº‹é¡¹

<Callout type="warning" title="æ³¨æ„">
  å¦‚æœä½ ä½¿ç”¨çš„ `User` è´¦æˆ·ç™»å½• å³ä½¿å‘½ä»¤æƒé™ä¸º `æ‰€æœ‰ç”¨æˆ·` çš„æƒ…å†µä¸‹,ä¹Ÿåªä¼šå›åº” `ä¸»äºº` å’Œ `ç®¡ç†å‘˜` ä»¥åŠ `è‡ªèº«` çš„å‘½ä»¤è¯·æ±‚,å…¶ä»–ç”¨æˆ·çš„å‘½ä»¤è¯·æ±‚ä¼šè¢«å¿½ç•¥ã€‚ä½¿ç”¨å‘½ä»¤ /setadmin add `<ç”¨æˆ·ID>` å¯ä»¥æ·»åŠ ç®¡ç†å‘˜ã€‚

  å¦‚æœä½ ä½¿ç”¨çš„ `Bot` è´¦æˆ·ç™»å½• åˆ™ä¸ä¼šæœ‰æ­¤é™åˆ¶ã€‚
</Callout>


# MongoDB å®‰è£…ä¸é…ç½® (/docs/1.start/install/Mongdb)

## 1.å®‰è£… MongoDB

### Windows

1. è¯·è®¿é—® [MongoDB å®˜æ–¹ä¸‹è½½é¡µé¢](https://www.mongodb.com/try/download/community) æ‰¾åˆ° `MongoDB Community Server` ç‚¹å‡» `Select package` é€‰æ‹©é€‚åˆä½ ç³»ç»Ÿçš„å®‰è£…åŒ…ï¼ˆé€šå¸¸æ˜¯ MSI å®‰è£…åŒ…ï¼‰ï¼Œç„¶åç‚¹å‡» `Download` ä¸‹è½½ã€‚
2. è¿è¡Œå®‰è£…ç¨‹åºï¼Œé€‰æ‹©â€œå®Œæ•´â€å®‰è£…ç±»å‹
3. å®‰è£…å®Œæˆåï¼ŒMongoDB ä¼šé»˜è®¤å¯åŠ¨ä¸º Windows æœåŠ¡ã€‚

é¢å¤–å·¥å…·ï¼šMongoDB Shell

* mongoshï¼ˆMongoDB Shellï¼‰ï¼šå¦‚æœä½ ä½¿ç”¨è¾ƒæ–°çš„ MongoDB ç‰ˆæœ¬ï¼Œæ¨èä½¿ç”¨ `mongosh`ã€‚å¯ä»¥ä»å®˜æ–¹é¡µé¢çš„ "Tools" æˆ–å•ç‹¬ä¸‹è½½é¡µé¢è·å–

### macOS

1. ä½¿ç”¨ Homebrew å®‰è£… MongoDBï¼š

   ```bash
   brew tap mongodb/brew
   brew install mongodb-community
   ```

2. å¯åŠ¨ MongoDB æœåŠ¡ï¼š

   ```bash
   brew services start mongodb/brew/mongodb-community
   ```

é¢å¤–å·¥å…·ï¼šmongosh

* ä½¿ç”¨ Homebrew å®‰è£… mongoshï¼š

  ```bash
  brew install mongosh
  ```

### Linux

1. ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… MongoDBï¼š

   ```bash
   sudo apt update
   sudo apt install -y mongodb
   ```

2. å¯åŠ¨ MongoDB æœåŠ¡ï¼š

   ```bash
   sudo systemctl start mongodb
   ```

é¢å¤–å·¥å…·ï¼šmongosh

* Ubuntu/Debianï¼ˆæ¨èä½¿ç”¨å®˜æ–¹ apt æºå®‰è£…æœ€æ–°çš„ mongosh å’Œ toolsï¼‰ï¼š

  ```bash
  # æ·»åŠ  MongoDB å®˜æ–¹æºä¹‹åå®‰è£… mongosh
  sudo apt install -y mongosh
  ```

* å¦‚æœä½¿ç”¨ç¤¾åŒºåŒ…ï¼Œå¯èƒ½éœ€è¦å•ç‹¬ä¸‹è½½å¹¶å®‰è£… `mongosh`çš„ deb åŒ…ã€‚

## 2.é…ç½® MongoDB

é»˜è®¤æƒ…å†µä¸‹ï¼ŒMongoDB ä¼šç›‘å¬æœ¬åœ°çš„ `27017` ç«¯å£ï¼Œå¹¶ä¸”åªèƒ½æœ¬åœ°è®¿é—®ã€‚å¦‚æœä½ éœ€è¦æ›´æ”¹é…ç½®ï¼Œå¯ä»¥ç¼–è¾‘ MongoDB çš„é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸ä½äº `/etc/mongod.conf` æˆ– `<å®‰è£…ç›®å½•>\MongoDB\Server\<version>\bin\mongod.cfg`ï¼‰ã€‚

ç¡®ä¿ MongoDB æœåŠ¡æ­£åœ¨è¿è¡Œï¼Œç„¶åä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¿æ¥å­—ç¬¦ä¸²è¿æ¥åˆ°æœ¬åœ°çš„ MongoDB å®ä¾‹ï¼š

```plaintext
mongodb://localhost:27017
```

### è®¾ç½®è´¦æˆ·å’Œå¯†ç 

MongoDB é»˜è®¤å®‰è£…åæ²¡æœ‰å¯ç”¨è´¦æˆ·å¯†ç è®¤è¯ã€‚å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒå¼€å¯è®¤è¯å¹¶è®¾ç½®ç®¡ç†å‘˜è´¦æˆ·ã€‚

#### 1. åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

1. æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¿æ¥åˆ° MongoDBï¼š
   ```powershell
   mongo
   ```
2. åˆ‡æ¢åˆ° `admin` æ•°æ®åº“ï¼š
   ```js
   use admin
   ```
3. åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼ˆè¯·æ›¿æ¢ç”¨æˆ·åå’Œå¯†ç ï¼‰ï¼š
   ```js
   db.createUser({
     user: "åç§°",
     pwd: "ä½ çš„å¯†ç ",
     roles: [ { role: "userAdminAnyDatabase", db: "admin" }, "readWriteAnyDatabase" ]
   })
   ```

#### 2. å¯ç”¨è®¤è¯

1. ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼ˆWindows é€šå¸¸åœ¨ `<å®‰è£…ç›®å½•>\MongoDB\Server\<version>\bin\mongod.cfg`ï¼‰ï¼š
   ```yaml
   security:
     authorization: enabled
   ```
2. é‡å¯ MongoDB æœåŠ¡ã€‚

#### 3. ä¿®æ”¹å¯†ç 

<Callout>
  å¦‚æœä½ åˆ›å»ºäº†ç®¡ç†å‘˜è´¦æˆ·åæ— æ³•ç™»å½•ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤ä¿®æ”¹å¯†ç ï¼š
</Callout>

1. å…³é—­è®¤è¯ï¼Œç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œæ³¨é‡Šæ‰ \`authorization: enabled
   ```yaml
   security:
    # authorization: enabled
   ```
   é‡å¯ MongoDB æœåŠ¡ã€‚

2. è¿æ¥åˆ° MongoDB å¹¶åˆ‡æ¢åˆ° `admin` æ•°æ®åº“ï¼š
   ```js
   use admin
   ```

3. ä¿®æ”¹å¯†ç ï¼ˆå°† `åç§°` å’Œ `æ–°å¯†ç ` æ›¿æ¢ä¸ºä½ çš„ç”¨æˆ·åå’Œæ–°å¯†ç ï¼‰ï¼š
   ```js
   db.changeUserPassword("åç§°", "æ–°å¯†ç ")
   ```

<Callout>
  è®°å¾—é‡æ–°å¯ç”¨è®¤è¯ï¼Œç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå–æ¶ˆæ³¨é‡Š `authorization: enabled`ï¼Œç„¶åé‡å¯ MongoDB æœåŠ¡ã€‚
</Callout>

### 3.å¯ç”¨è®¤è¯åå¸¸ç”¨çš„è¿æ¥å­—ç¬¦ä¸²ç¤ºä¾‹

å¯ç”¨è®¤è¯åï¼Œå®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨å¸¦å‡­è¯çš„è¿æ¥å­—ç¬¦ä¸²ã€‚å…¶ä¸­å¸¸è§å½¢å¼åŒ…æ‹¬ï¼š

```plaintext
mongodb://<username>:<password>@localhost:27017/?authSource=admin
```

* å¸¦æœ‰æ•°æ®åº“åç§°çš„è¿æ¥å­—ç¬¦ä¸²ï¼š

```plaintext
mongodb://<username>:<password>@localhost:27017/<database>?authSource=admin
```

å‚æ•°è¯´æ˜ï¼ˆå¸¸ç”¨ï¼‰ï¼š

* `<username>`ï¼šè¿æ¥æ•°æ®åº“çš„ç”¨æˆ·åã€‚
* `<password>`ï¼šè¿æ¥æ•°æ®åº“çš„å¯†ç ã€‚
* `<database>`ï¼šè¦è¿æ¥çš„æ•°æ®åº“åç§°ã€‚
* `authSource`ï¼šæŒ‡å®šç”¨äºè®¤è¯çš„æ•°æ®åº“ï¼ˆé€šå¸¸ä¸º `admin`ï¼‰ã€‚

***

## å…¬å¼€ MongoDB åˆ°å…¬ç½‘

é»˜è®¤æƒ…å†µä¸‹ï¼ŒMongoDB åªç›‘å¬æœ¬åœ° `127.0.0.1`ã€‚å¦‚éœ€è®©å¤–éƒ¨è®¾å¤‡è®¿é—®ï¼Œéœ€è¦ä¿®æ”¹ç»‘å®šåœ°å€ã€‚

### æ­¥éª¤

1. ç¼–è¾‘é…ç½®æ–‡ä»¶`mongod.conf`ï¼Œæ‰¾åˆ° `net` é…ç½®é¡¹å¹¶ä¿®æ”¹`bindIp`ï¼š
   ```yaml
   net:
     port: 27017 # ä½ å¯ä»¥æ ¹æ®éœ€è¦æ›´æ”¹ç«¯å£
     bindIp: 0.0.0.0
   ```
   è¿™æ ·ä¼šå…è®¸æ‰€æœ‰ IP è®¿é—® MongoDBã€‚
2. é‡å¯ MongoDB æœåŠ¡ã€‚
3. ç¡®ä¿é˜²ç«å¢™å·²å¼€æ”¾ 27017 ç«¯å£ï¼Œå¹¶è®¾ç½®å®‰å…¨è§„åˆ™ï¼Œé¿å…æš´éœ²æ•°æ®åº“åˆ°ä¸å¯ä¿¡ç½‘ç»œã€‚

<Callout title="æ³¨æ„" type="error">
  **å®‰å…¨æç¤º**ï¼šå¼ºçƒˆå»ºè®®å¼€å¯è®¤è¯ã€è®¾ç½®å¼ºå¯†ç ï¼Œå¹¶é™åˆ¶è®¿é—®æ¥æº IPã€‚
</Callout>


# Node.js å®‰è£… (/docs/1.start/install/nodejs)

## å®‰è£… Node.js

### Windows

1. è®¿é—® [Node.js å®˜æ–¹ä¸‹è½½é¡µé¢](https://nodejs.org/zh-cn/download)ã€‚
2. ç‚¹å‡» Windows Installer (.msi) ä¸‹è½½é€‚ç”¨äº Windows çš„å®‰è£…åŒ…ã€‚
3. è¿è¡Œä¸‹è½½çš„å®‰è£…ç¨‹åºï¼ŒæŒ‰ç…§æç¤ºå®Œæˆå®‰è£…ã€‚

### macOS & Linux

å‰å¾€ [Node.js å®˜æ–¹ç½‘ç«™](https://nodejs.org/zh-cn/download) ä¸‹è½½é€‚ç”¨äºä½ æ“ä½œç³»ç»Ÿçš„å®‰è£…åŒ…ã€‚

æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£… Node.jsï¼š

* **macOS**ï¼ˆä½¿ç”¨ Homebrewï¼‰ï¼š

  ```bash
  brew install node
  ```
* **Ubuntu/Debian**ï¼š

  ```bash
  sudo apt update
  sudo apt install -y nodejs npm
  ```


# Telegram API è·å– (/docs/1.start/install/tgapi)

## è·å– Telegram API ID å’Œ API Hash

è¦ä½¿ç”¨ Fuyu-TDBotï¼Œæ‚¨éœ€è¦ä» Telegram è·å– `API ID` å’Œ `API Hash`ã€‚ä»¥ä¸‹æ˜¯è·å–è¿™äº›ä¿¡æ¯çš„æ­¥éª¤ï¼š

å†…å®¹æ¥æºäº [Telegram å®˜æ–¹æ–‡æ¡£](https://core.telegram.org/api/obtaining_api_id#obtaining-api-id)ã€‚

### è·å–api\_id

ä¸ºäº†è·å– `API ID` å¹¶ä½¿ç”¨ Telegram API å¼€å‘æ‚¨è‡ªå·±çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨éœ€è¦æ‰§è¡Œä»¥ä¸‹ä½œï¼š

* ä½¿ç”¨å®˜æ–¹åº”ç”¨ç¨‹åºæ³¨å†Œ Telegramã€‚
* ç™»å½•æ‚¨çš„ Telegram æ ¸å¿ƒï¼š[https://my.telegram.orgã€‚](https://my.telegram.orgã€‚)
* è½¬åˆ° `API development tools` å¹¶å¡«å†™è¡¨æ ¼ã€‚
* æ‚¨å°†è·å¾—åŸºæœ¬åœ°å€ä»¥åŠç”¨æˆ·æˆæƒæ‰€éœ€çš„`api_id`å’Œ`api_hash`å‚æ•°ã€‚
* ç›®å‰ï¼Œæ¯ä¸ªå·ç åªèƒ½æ³¨å†Œä¸€ä¸ª`api_id`ã€‚

TGå°†å‘æ‚¨åœ¨æ­¤è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ç”µè¯å·ç å‘é€é‡è¦çš„å¼€å‘è€…é€šçŸ¥ï¼Œå› æ­¤è¯·ä½¿ç”¨è¿æ¥åˆ°æ‚¨æ´»åŠ¨ Telegram å¸æˆ·çš„æœ€æ–°å·ç ã€‚

### ä½¿ç”¨ api\_id

åœ¨ä½¿ç”¨ MTProto Telegram API ä¹‹å‰ï¼Œè¯·æ³¨æ„ä»¥ä¸‹äº‹é¡¹ï¼š
Telegram

* æ‰€æœ‰ API å®¢æˆ·ç«¯åº“éƒ½å—åˆ°ä¸¥æ ¼ç›‘æ§ï¼Œä»¥é˜²æ­¢æ»¥ç”¨ã€‚

* å¦‚æœä½ ä½¿ç”¨ Telegram API è¿›è¡Œåˆ·å±ã€åƒåœ¾ä¿¡æ¯ã€ä¼ªé€ é¢‘é“çš„è®¢é˜…æ•°æˆ–è§‚çœ‹æ•°ï¼Œä½ å°†è¢«æ°¸ä¹…å°ç¦ã€‚

* ç”±äº Telegram API æ»¥ç”¨ä¸¥é‡ï¼Œæ‰€æœ‰ä½¿ç”¨éå®˜æ–¹ Telegram API å®¢æˆ·ç«¯ç™»å½•çš„è´¦æˆ·éƒ½ä¼šè¢«è‡ªåŠ¨ç½®äºè§‚å¯ŸçŠ¶æ€ï¼Œä»¥é˜²æ­¢è¿åæœåŠ¡æ¡æ¬¾ã€‚

* å¦‚æœä½ æ²¡æœ‰è¿åæœåŠ¡æ¡æ¬¾ï¼Œä½†åœ¨ä½¿ç”¨ API åä½ çš„è´¦æˆ·è¢«å°ç¦ï¼Œè¯·å‘é‚®ä»¶è‡³ [recover@telegram.org](mailto:recover@telegram.org)ï¼Œè§£é‡Šä½ ä½¿ç”¨ API çš„æ„å›¾ï¼Œè¯·æ±‚è§£å°ã€‚

è¯·æ³¨æ„ï¼Œé‚®ä»¶éœ€è¦äººå·¥å®¡æ ¸ï¼Œå› æ­¤è‡ªåŠ¨ç”Ÿæˆçš„é‚®ä»¶å¯èƒ½ä¼šè¢«æ£€æµ‹å¹¶å°ç¦ã€‚


# å¿«é€Ÿæ¨¡æ¿ (/docs/2.plugin/Examples/1)

### å¿«é€Ÿå¼€å§‹

```ts title="Examples.ts"
import { Plugin } from "@plugin/BasePlugin.ts";
import type { Client } from "tdl";
import { sendMessage } from "@TDLib/function/message.ts";
import type { updateNewMessage } from "tdlib-types";

export default class LifePlugin extends Plugin {
  type = "æ’ä»¶é€‚ç”¨çš„è¿è¡Œä¸»ä½“";
  name = "æ’ä»¶å”¯ä¸€åç§°";
  version = "æ’ä»¶ç‰ˆæœ¬å·";
  description = "ç®€çŸ­æè¿°";
  constructor(client: Client) {
    super(client);
    this.cmdHandlers = {
      æ’ä»¶å‘½ä»¤: {
        description: "è¯¦ç»†çš„æ’ä»¶ä»‹ç»",
        handler: async (Update, _args) => {
          æ”¶åˆ°æ¶ˆæ¯å;
        },
      },
    };
  }
}
```


# å¤šå‘½ä»¤ (/docs/2.plugin/Examples/2)

### å¤šå‘½ä»¤

```ts
import { Plugin } from "@plugin/BasePlugin.ts";
import type { Client } from "tdl";

export default class BgmPlugin extends Plugin {
  type = "æ’ä»¶é€‚ç”¨çš„è¿è¡Œä¸»ä½“";
  name = "æ’ä»¶å”¯ä¸€åç§°";
  version = "æ’ä»¶ç‰ˆæœ¬å·";
  description = "ç®€çŸ­æè¿°";
  constructor(client: Client) {
    super(client);
    this.cmdHandlers = {
      å‘½ä»¤1: {
        description: "è¯¦ç»†çš„æ’ä»¶ä»‹ç»",
        handler: async (update, _args) => {
          const mod = await import("å¯¹åº”æ–¹æ³•ç›®å½•");
          return mod.default(this.client, update.message, _args);
        },
      },
      å‘½ä»¤2: {
        description: "è¯¦ç»†çš„æ’ä»¶ä»‹ç»",
        handler: async (update, _args) => {
          const mod = await import("å¯¹åº”æ–¹æ³•ç›®å½•");
          return mod.default(this.client, update.message, _args);
        },
      },
      //ä»¥æ­¤ç±»æ¨
    };
  }
}
```


# å®Œæ•´ç¤ºä¾‹ (/docs/2.plugin/Examples/3)

## 3. ç¤ºä¾‹æ’ä»¶

```ts
import type { Client } from "tdl";
import { Plugin } from "@plugin/BasePlugin.ts";
import logger from "@log/index.ts";

export default class HelloPlugin extends Plugin {
	name = "hello";
	version = "0.1.0";
	type = "general"; // æ’ä»¶ç±»å‹ï¼Œåªèƒ½ bot ä½¿ç”¨(ä½¿ç”¨äº†botçš„å›è°ƒæŒ‰é’®)è¿˜æ˜¯ user (ä½¿ç”¨äº†botä¸èƒ½ä½¿ç”¨çš„æ–¹æ³•) å¦‚ä½•éƒ½èƒ½ç”¨åˆ™æ˜¯general
	description = "ç¤ºä¾‹ï¼šå“åº” /hello å‘½ä»¤";
    // [!code highlight]
    // å®šæ—¶ä»»åŠ¡
	runHandlers = {
		heartbeat: {
			description: "æ¯ 30 ç§’è¾“å‡ºå¿ƒè·³æ—¥å¿—",
			intervalMs: 30_000,
			immediate: true,
			handler: () => {
				logger.info("[HelloPlugin] heartbeat");
			},
		},
	};

	constructor(client: Client) {
		super(client);
        // [!code highlight]
        // å‘½ä»¤æ³¨å†Œ
		this.cmdHandlers = {
			hello: {
				description: "å›å¤ 'ä½ å¥½ï¼Œä¸–ç•Œï¼'",
				scope:"all"
				permission:"all"
				handler: async (updateNewMessage, args) => {
					try {
						await this.client.invoke({
							_: "sendMessage",
							chat_id: updateNewMessage.message.chat_id,
							input_message_content: {
								_: "inputMessageText",
								text: { _: "formattedText", text: "ä½ å¥½ï¼Œä¸–ç•Œï¼" },
							},
						});
					} catch (e) {
						logger.error("å‘é€æ¶ˆæ¯å¤±è´¥", e);
					}
				},
			},
		};
    // [!code highlight]
    // æ¥æ”¶æ›´æ–°
		this.updateHandlers = {
			updateNewMessage: {
				handler: async () => {
					// å¤„ç†æ–°æ¶ˆæ¯é€»è¾‘
				},
			},
		};
	}
    // [!code highlight]
    // åˆå§‹åŒ–
	async onLoad() {
		logger.info("HelloPlugin å·²åŠ è½½ï¼Œæ‰§è¡Œä¸€æ¬¡æ€§åˆå§‹åŒ–");
	}
    // [!code highlight]
    // èµ„æºæ¸…ç†
	async destroy() {
		// æ¸…ç†èµ„æºæˆ–å®šæ—¶å™¨
	}
}
```


# å‘½ä»¤æ³¨å†Œ (/docs/2.plugin/Sample/1)

#### å‘½ä»¤æ³¨å†Œ

* `cmdHandlers: Record<string, CommandDef>`ï¼šå‘½ä»¤è·¯ç”±è¡¨ï¼Œä»…åœ¨éœ€è¦å“åº”å‘½ä»¤æ—¶èµ‹å€¼ã€‚å•ä¸ªå‘½ä»¤å¯è¿›ä¸€æ­¥å£°æ˜ `description`ã€`handler`ã€`scope` ä¸ `permission`ã€‚

| å­—æ®µ            | é»˜è®¤    | ä½œç”¨                                                                                        |
| ------------- | ----- | ----------------------------------------------------------------------------------------- |
| `description` | å¿…å¡«å­—æ®µ  | å‘½ä»¤çš„ç®€çŸ­æè¿°                                                                                   |
| `scope[]?`    | "all" | å‘½ä»¤çš„è¿è¡Œç¯å¢ƒ `"all"`: æ‰€æœ‰åœºæ™¯éƒ½èƒ½ä½¿ç”¨ `"private"`: åªèƒ½åœ¨ç§èŠä¸­ä½¿ç”¨ `"group"`: åªèƒ½åœ¨ç¾¤ç»„ä¸­ä½¿ç”¨ `"channel"`: åªèƒ½åœ¨é¢‘é“ä¸­ä½¿ç”¨ |
| `permission?` | "all" | å‘½ä»¤çš„è°ƒç”¨æƒé™ `owner`: åªæœ‰è¶…çº§ç®¡ç†å‘˜èƒ½ä½¿ç”¨`admin`: ç®¡ç†å‘˜å’Œè¶…çº§ç®¡ç†å‘˜éƒ½èƒ½ä½¿ç”¨`all`: æ‰€æœ‰äººéƒ½èƒ½ä½¿ç”¨                           |
| `showInHelp`  | true  | è¯¥å‘½ä»¤æ˜¯å¦åœ¨å¸®åŠ©åˆ—è¡¨ä¸­æ˜¾ç¤º                                                                             |
| `handler`     | å¿…å¡«å­—æ®µ  | å‘½ä»¤å¤„ç†å™¨                                                                                     |

å¯ä»¥ä½¿ç”¨æˆ‘ä»¬ TDLib å°è£…æ–¹æ³•æˆ–è€… TDLib çš„åŸå§‹è°ƒç”¨æ–¹æ³•æ¥è°ƒç”¨ [TDLib æ–¹æ³• æ–‡æ¡£](https://core.telegram.org/tdlib/docs/classtd_1_1td__api_1_1_function.html)ã€‚

```ts title="Examples.ts"
import { Plugin } from "@plugin/BasePlugin.ts";
import type { Client } from "tdl";
import type { updateNewMessage } from "tdlib-types";

export default class LifePlugin extends Plugin {
  name = "æ’ä»¶å”¯ä¸€åç§°";
  type = "general";
  version = "æ’ä»¶ç‰ˆæœ¬å·";
  description = "ç®€çŸ­æè¿°";

  constructor(client: Client) {
    super(client);

	this.cmdHandlers = {
			// å‘½ä»¤æ³¨å†Œåç§° // [!code highlight]
			hello: {// [!code highlight]
				description: "å›å¤ 'ä½ å¥½ï¼Œä¸–ç•Œï¼'",// [!code highlight]
				scope:["all"]// [!code highlight]
				permission:"all"// [!code highlight]
				showInHelp: true // [!code highlight]
				handler: async (updateNewMessage, args) => {  // [!code highlight]
					try {
						await this.client.invoke({
							_: "sendMessage",
							chat_id: updateNewMessage.message.chat_id,
							input_message_content: {
								_: "inputMessageText",
								text: { _: "formattedText", text: "ä½ å¥½ï¼Œä¸–ç•Œï¼" },
							},
						});
					} catch (e) {
						logger.error("å‘é€æ¶ˆæ¯å¤±è´¥", e);
					}
				},
			},
		};
  }
}
```


# æ›´æ–°äº‹ä»¶æ³¨å†Œ (/docs/2.plugin/Sample/2)

#### æ›´æ–°äº‹ä»¶æ³¨å†Œ

* `updateHandlers: Record<string, UpdateDef>`ï¼šTDLib æ›´æ–°å¤„ç†è¡¨ï¼Œä»…åœ¨éœ€è¦æ¥æ”¶æ›´æ–°æ—¶è¿è¡Œå¤„ç†å™¨

æ‰€æœ‰çš„æ›´æ–°éƒ½å¯ä»¥åœ¨[TDLib Update æ–‡æ¡£](https://core.telegram.org/tdlib/docs/classtd_1_1td__api_1_1_update.html)ã€‚ä¸­æŸ¥æ‰¾åˆ°

```ts
import type { Client } from "tdl";
import { Plugin } from "@plugin/BasePlugin.ts";

export default class HelloPlugin extends Plugin {
  name = "æ’ä»¶å”¯ä¸€åç§°";
  type = "general";
  version = "æ’ä»¶ç‰ˆæœ¬å·";
  description = "ç®€çŸ­æè¿°";

  constructor(client: Client) {
    super(client);

    this.updateHandlers = {
      // updateNewMessage ä¸ºéœ€è¦æ¥æ”¶çš„æ›´æ–°
      // [!code word:updateNewMessage]
      // [!code highlight]
      updateNewMessage: {
        // update ä¸ºæ”¶åˆ°çš„æ›´æ–°å†…å®¹   // [!code highlight]
        // [!code word:update]
        // [!code highlight]
        handler: async (update) => {
          // [!code highlight]
          console.log(update);
        }, // [!code highlight]
      }, // [!code highlight]
    };
  }
}
```


# æ’ä»¶åˆå§‹åŒ– (/docs/2.plugin/Sample/3)

### è¢«æ³¨å†Œæ—¶ç«‹å³æ‰§è¡Œ

```ts
	async onLoad() {
		logger.info("HelloPlugin å·²åŠ è½½ï¼Œæ‰§è¡Œä¸€æ¬¡æ€§åˆå§‹åŒ–");
	}

```


# å®šæ—¶ä»»åŠ¡ (/docs/2.plugin/Sample/4)

### å®šæ—¶ä»»åŠ¡

```ts
runHandlers = {
  heartbeat: {
    description: "æ¯ 30 ç§’è¾“å‡ºå¿ƒè·³æ—¥å¿—",
    intervalMs: 30_000,
    immediate: true,
    handler: () => {
      logger.info("[HelloPlugin] heartbeat");
    },
  },
};
```


# å›¾ç‰‡ç”Ÿæˆ (/docs/2.plugin/Sample/5)

## ä»‹ç»

å›¾ç‰‡ç”Ÿæˆä¸»è¦ä¾é  `satori` è¿›è¡Œç”Ÿæˆå›¾ç‰‡

å¯ä»¥å°† Vue æ¨¡æ¿æ¸²æŸ“æˆå›¾ç‰‡

## é¡»çŸ¥äº‹é¡¹

* x-satori è´Ÿè´£æŠŠæœ€ç»ˆçš„é™æ€ HTML æ¸²æŸ“ä¸ºå›¾ç‰‡ï¼Œå®ƒä¸ä¼šæ‰§è¡Œæˆ–è¿è¡Œ Vue ç»„ä»¶ä¸­çš„ JavaScriptï¼ˆä¾‹å¦‚ `<script>` å†…çš„é€»è¾‘ã€å“åº”å¼çŠ¶æ€æˆ–ç”Ÿå‘½å‘¨æœŸé’©å­ï¼‰ï¼Œä¹Ÿä¸ä¼šå¤„ç†ç»„ä»¶èŒƒå›´å†…çš„ `<style>`ï¼ˆåŒ…æ‹¬ scoped/style modulesï¼‰ã€‚å› æ­¤ï¼Œä»…ä¾èµ–ç»„ä»¶å†…è„šæœ¬æˆ–æ ·å¼æ¥ç”Ÿæˆæœ€ç»ˆæ•ˆæœé€šå¸¸ä¸ä¼šç”Ÿæ•ˆã€‚

* ç”±äº satori å¹¶ä¸å®Œæ•´åœ°åº”ç”¨ç»„ä»¶çº§æ ·å¼ï¼Œå•çº¯ä¾é  `class` å¼•å…¥çš„æ ·å¼é€šå¸¸ä¸å¯é¢„æœŸã€‚satori å¯¹éƒ¨åˆ† Tailwind CSS ç±»æœ‰å†…ç½®æ”¯æŒï¼Œä½†æ”¯æŒèŒƒå›´æœ‰é™ä¸”å¯èƒ½éšç‰ˆæœ¬å˜åŒ–ï¼Œä½¿ç”¨å‰è¯·åŠ¡å¿…è‡ªè¡Œæµ‹è¯•ã€‚å¦‚æœä½ åœ¨ `class` ä¸­ä½¿ç”¨ Tailwindï¼Œè¯·åœ¨ç›®æ ‡ç¯å¢ƒä¸­éªŒè¯æ ·å¼æ˜¯å¦ç”Ÿæ•ˆã€‚

* è¦ä¿è¯æ ·å¼åœ¨å›¾ç‰‡ä¸­ç”Ÿæ•ˆï¼Œæ¨èå°†å…³é”®æ ·å¼å†™ä¸ºå†…è”æ ·å¼ï¼ˆä¾‹å¦‚ `style="..."`ï¼‰ï¼Œæˆ–è€…åœ¨æ¸²æŸ“å‰æŠŠæ¨¡æ¿é¢„æ¸²æŸ“ä¸ºåŒ…å«æœ€ç»ˆæ ·å¼çš„é™æ€ HTML å†äº¤ç»™ satoriã€‚å¯ä»¥å‚è€ƒ satori çš„ CSS æ”¯æŒåˆ—è¡¨æ¥ç¡®è®¤å“ªäº› CSS å±æ€§è¢«æ”¯æŒ

<Callout title="satori æ”¯æŒçš„ CSS åˆ—è¡¨ï¼ˆå‚è€ƒï¼‰">
  [https://github.com/vercel/satori?tab=readme-ov-file#css](https://github.com/vercel/satori?tab=readme-ov-file#css)
</Callout>

```vue title="template.vue"
<template>
  {/* ä¸ç”Ÿæ•ˆéƒ¨åˆ† */}
  {/* [!code word:box] */}
  <div class="box" style="display: flex;">
    {{ title }}
  </div>
  <div style="display: flex;">
  {/* ä¸ç”Ÿæ•ˆéƒ¨åˆ† */}
  {/* [!code highlight] */}
    {{ newtitle }}
  </div>
  <div v-for="value in fortest" :key="value" style="display: flex;">
    <p>value: {{ value }}</p>
  </div>
  <div v-if="show" style="display: flex;">éšè—å†…å®¹</div>
</template>
<script setup lang="ts">
// ä¸ç”Ÿæ•ˆéƒ¨åˆ†
// [!code highlight]
import { ref } from "vue";

// è¿™é‡Œæ˜¯ä¼ é€’å‚æ•°éƒ¨åˆ†
defineProps<{
  title?: string;
  fortest?: number;
  show?: boolean;
}>();

// ä¸ç”Ÿæ•ˆéƒ¨åˆ†
// [!code highlight]
const newtitle = ref("æ–°æ ‡é¢˜");
</script>

// ä¸ç”Ÿæ•ˆéƒ¨åˆ†
{/* [!code highlight] */}
<style scoped>
/* [!code highlight] */
.box {
  /* [!code highlight] */
  width: 100px; /* [!code highlight] */
  height: 100px; /* [!code highlight] */
  background-color: red; /* [!code highlight] */
} /* [!code highlight] */
/* [!code highlight] */
</style>
```

## ä½¿ç”¨æ–¹æ³•

åœ¨ @function/genImg.ts ä¸­ æˆ‘ä»¬åŒ…è£…äº†ä¸€ä¸ª generateImage æ–¹æ³•ç”¨äºå›¾ç‰‡ç”Ÿæˆ

ä¸‹é¢æ˜¯ `generateImage` æ–¹æ³•çš„ç±»å‹è¡¨ï¼Œä½¿ç”¨é¡¹ç›®å†…ç½®çš„ `TypeTable` ç»„ä»¶å±•ç¤ºå‚æ•°è¯´æ˜ä¸è¿”å›å€¼ï¼š

<TypeTable
  type={{
  "options": {
    description: "å›¾ç‰‡ç”Ÿæˆé€‰é¡¹å¯¹è±¡",
    type: <code>{`{ width: number | 'auto'; height: number | 'auto'; fonts?: FontOptions[]; debug?: boolean; quality?: number; imgname?: string; format?: 'png' | 'jpg' | 'jpeg'; jpegQuality?: number }`}</code>,
    parameters: [
      { name: 'width', description: <span>å›¾ç‰‡å®½åº¦ï¼Œæ•°å­—æˆ–å­—ç¬¦ä¸² <code>"auto"</code></span> },
      { name: 'height', description: <span>å›¾ç‰‡é«˜åº¦ï¼Œæ•°å­—æˆ–å­—ç¬¦ä¸² <code>"auto"</code></span> },
      { name: 'fonts', description: <span>å­—ä½“é…ç½®æ•°ç»„ï¼Œè¯¦è§ <code>FontOptions</code></span> },
      { name: 'debug', description: 'æ˜¯å¦æ‰“å¼€è°ƒè¯•æ¨¡å¼ï¼Œè°ƒè¯•æ¨¡å¼ä¸‹ä¼šä¿ç•™ä¸­é—´æ–‡ä»¶' },
      { name: 'quality', description: 'è¾“å‡ºè´¨é‡ (0-100)ï¼Œä»…å¯¹æŸäº›æ ¼å¼ç”Ÿæ•ˆ' },
      { name: 'imgname', description: 'ç”Ÿæˆæ–‡ä»¶åï¼ˆå¯é€‰ï¼‰ï¼Œä¸å«æ‰©å±•å' },
      { name: 'format', description: "å›¾ç‰‡æ ¼å¼ï¼š'png' | 'jpg' | 'jpeg'" },
      { name: 'jpegQuality', description: 'å½“ format ä¸º jpeg/jpg æ—¶ä½¿ç”¨çš„è´¨é‡è®¾ç½® (0-100)' },
    ],
  },
  "vuetemplateStr": {
    description: 'Vue æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œç”¨äºæ¸²æŸ“å›¾ç‰‡çš„é™æ€ HTML',
    type: <code>string</code>,
  },
  "props": {
    description: 'ä¼ å…¥ Vue æ¨¡æ¿çš„å±æ€§å¯¹è±¡ï¼ˆå¯é€‰ï¼‰',
    type: <code>Record&lt;string, any&gt;</code>,
    default: <code>{`{}`}</code>,
  },
}}
/>

ç¤ºä¾‹ï¼š

<Files>
  <File name="test.ts" />

  <File name="template.vue" />
</Files>

```ts title="test.ts"
import template from "./template.vue?raw";
import { generateImage } from "@function/genImg.ts";
// è°ƒç”¨ç¤ºä¾‹
const result = await generateImage(
  {
    width: 1200,
    height: 630,
    format: 'png',
    imgname: 'og-image',
  },
  template
  { title: 'ç¤ºä¾‹æ ‡é¢˜' },
);

```

## è¿”å›å¤„ç†

`generateImage` æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å«ç”Ÿæˆå›¾ç‰‡ä¿¡æ¯çš„å¯¹è±¡ï¼š

```ts
{
  path: '/tmp/og-image.png',
  width: 1200,
  height: 630,
  hash: 'abcd1234',
  file_id: 'file_5678'
}
```

<TypeTable
  type={{
  path: {
    description:
      'å›¾ç‰‡çš„ç»å¯¹è·¯å¾„ (å¦‚ä½•æ²¡æœ‰è·¯å¾„å°±æ˜¯æœ‰ç¼“å­˜ä½¿ç”¨ file_id å‘é€å›¾ç‰‡ï¼Œé¿å…é‡å¤ä¸Šä¼ )',
    type: 'string',
  },
  width: {
    description: 'å›¾ç‰‡å®½åº¦ï¼Œå•ä½åƒç´ ',
    type: 'number',
  },
  height: {
    description: 'å›¾ç‰‡é«˜åº¦ï¼Œå•ä½åƒç´ ',
    type: 'number',
  },
  hash: {
    description: 'å›¾ç‰‡å†…å®¹çš„å“ˆå¸Œå€¼',
    type: 'string',
  },
  file_id: {
    description: 'ä¸Šä¼ åˆ° Telegram åçš„æ–‡ä»¶ ID(å½“æœ‰ path æ—¶è¡¨ç¤ºè¯¥å‚æ•°æœ‰ç¼“å­˜å›¾ç‰‡)',
    type: 'string',
  },
}}
/>

```ts
import { sendMessage } from "@TDLib/function/message.ts";
import { generateImage } from "@function/genImg.ts";
import { updateImgCache } from "@db/update.ts";
import fs from "fs";


const imagePath = await generateImage(
  {
    width: 1200,
    height: "auto",
  },
  templateStr,
  props
);
// å½“æœ‰è·¯å¾„æ—¶è¡¨ç¤ºå›¾ç‰‡ç”ŸæˆæˆåŠŸå¹¶ä¸”æ²¡æœ‰ç¼“å­˜éœ€è¦è¿›è¡Œä¸Šä¼ 
if (imagePath.path) {
  const result = await sendMessage(client, message.message.chat_id, {
    media: {
      photo: {
        path: imagePath.path,
      },
    },
  });
  // ä¿å­˜ file_id åˆ°ç¼“å­˜
  if (result && result.content._ === "messagePhoto" && imagePath.hash) {
    const file_id = result.content.photo.sizes.slice(-1)[0].photo.remote.id;
    try {
      await updateImgCache(imagePath.hash, file_id);
    } catch (err) {
      logger.warn("ä¿å­˜ file_id ç¼“å­˜å¤±è´¥", err);
    }
  }
  // å¯é€‰åˆ é™¤ä¸´æ—¶æ–‡ä»¶
  await fs.promises.unlink(imagePath.path);
  return;
}

// å½“æœ‰ç¼“å­˜æ—¶pathä¼šä¸ºç©ºï¼Œfile_id è¿›è¡Œå‘é€
if ((imagePath.hash, imagePath.file_id)) {
  await sendMessage(client, message.message.chat_id, {
    media: {
      photo: {
        id: imagePath.file_id,
      },
    },
  });
  return;
}
// å›¾ç‰‡ç”Ÿæˆå¤±è´¥é”™è¯¯å¤„ç†
await sendMessage(client, message.message.chat_id, {
  text: "å›¾ç‰‡ç”Ÿæˆå¤±è´¥",
});
```


# æ’ä»¶å¼€å‘å¸®åŠ© (/docs/2.plugin/Sample)

## æ’ä»¶æ¥å£ä¸€è§ˆ

### 1 å¿…éœ€å­—æ®µï¼ˆå®ä¾‹å±æ€§ï¼‰

* `name: string`ï¼šæ’ä»¶å”¯ä¸€åç§°ã€‚
* `type: "user" | "bot" | "general"`ï¼šæ’ä»¶é€‚ç”¨çš„è¿è¡Œä¸»ä½“ã€‚
* `version: string`ï¼šæ’ä»¶ç‰ˆæœ¬å·ã€‚
* `description: string`ï¼šç®€çŸ­æè¿°ã€‚

```ts title="Examples.ts"
import { Plugin } from "@plugin/BasePlugin.ts";
import type { Client } from "tdl";
import type { updateNewMessage } from "tdlib-types";

export default class LifePlugin extends Plugin {
  name = "æ’ä»¶å”¯ä¸€åç§°"; // [!code highlight]
  type = "general"; // [!code highlight]
  version = "æ’ä»¶ç‰ˆæœ¬å·"; // [!code highlight]
  description = "ç®€çŸ­æè¿°"; // [!code highlight]

  constructor(client: Client) {
    super(client);
  }
}
```

`type` ç”¨æ¥æŒ‡æ˜æ’ä»¶è¿è¡Œçš„ç¯å¢ƒ

* `user`ï¼šæ’ä»¶ä¸­åŒ…å«åªèƒ½ä½¿ç”¨ user è´¦æˆ·èƒ½ä½¿ç”¨çš„åŠŸèƒ½ï¼ˆå¦‚åˆ é™¤ 48 å°æ—¶å‰æ¶ˆæ¯ï¼‰ã€‚
* `bot`ï¼šä¾èµ– Bot API ç‰¹æ€§ï¼ˆå¦‚å†…è”æŒ‰é’®ï¼‰ã€‚
* `general`ï¼šä¸¤ä¾§å‡å¯ä½¿ç”¨ã€‚

```ts title="typeéƒ¨åˆ†"
// [!code word:"general"]
type = "general";
```

### 2 å¯é€‰ç”Ÿå‘½å‘¨æœŸ & è¿è¡Œä»»åŠ¡

| å­—æ®µ/æ–¹æ³•         | ä½œç”¨                                                                     |
| ------------- | ---------------------------------------------------------------------- |
| `onLoad()`    | æ’ä»¶è¢«å®ä¾‹åŒ–å¹¶æ³¨å†Œåç«‹å³è°ƒç”¨ï¼Œç”¨äºä¸€æ¬¡æ€§åˆå§‹åŒ–ã€‚                                               |
| `runHandlers` | æ³¨å†Œå¯ç›´æ¥è§¦å‘æˆ–å®šæ—¶æ‰§è¡Œçš„ä»»åŠ¡ã€‚æ”¯æŒ `cron` è¡¨è¾¾å¼æˆ– `intervalMs` è½®è¯¢ï¼Œ`immediate` å¯åœ¨åŠ è½½æ—¶å…ˆè¿è¡Œä¸€æ¬¡ã€‚ |
| `destroy()`   | å¸è½½å‰è°ƒç”¨ï¼Œç”¨äºæ¸…ç†èµ„æºã€å…³é—­å®šæ—¶å™¨ç­‰ã€‚                                                   |

`runHandlers` çš„å®šä¹‰ï¼š

```ts
type RunDef = {
  description?: string;
  handler: () => Promise<void> | void;
  cron?: string; // ä¼˜å…ˆä½¿ç”¨ cronï¼Œä¾èµ– cron åŒ…ï¼Œæ”¯æŒç§’çº§è¡¨è¾¾å¼
  intervalMs?: number; // æ¯«ç§’çº§è½®è¯¢
  immediate?: boolean; // åŠ è½½åç«‹å³æ‰§è¡Œä¸€æ¬¡
};
```


# è·å–å¯¹è¯çš„åŸºæœ¬ä¿¡æ¯ (/docs/2.plugin/function/getChat)

<TypeTable
  type={{
  client: {
    description:
      'TDLib å®¢æˆ·ç«¯å®ä¾‹',
    type: 'Client',
  },
  chat_id: {
    description: 'è¦è·å–ä¿¡æ¯çš„å¯¹è¯ ID',
    type: 'number',
  },
}}
/>

#### è·å–å¯¹è¯ä¿¡æ¯

å¯ä»¥ä½¿ç”¨ TDLib çš„ `getChat` æ–¹æ³•æ¥è·å–å¯¹è¯çš„åŸºæœ¬ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºå¦‚ä½•åœ¨æ’ä»¶ä¸­å®ç°è¿™ä¸€åŠŸèƒ½ï¼š

```ts title="ChatInfo.ts"
import { getChat } from "@TDLib/function/chat.ts";

const chat = await getChat(client, chat_id);
```

#### è¿”å›å†…å®¹

[chat Class Reference](https://core.telegram.org/tdlib/docs/classtd_1_1td__api_1_1chat.html)


# è·å–è¶…çº§ç¾¤ç»„çš„åŸºæœ¬ä¿¡æ¯ (/docs/2.plugin/function/getSupergroup)

<TypeTable
  type={{
  client: {
    description:
      'TDLib å®¢æˆ·ç«¯å®ä¾‹',
    type: 'Client',
  },
  supergroup_id: {
    description: 'è¦è·å–ä¿¡æ¯çš„è¶…çº§ç¾¤ç»„ ID',
    type: 'number',
  },
}}
/>

#### è·å–è¶…çº§ç¾¤ç»„ä¿¡æ¯

å¯ä»¥ä½¿ç”¨ TDLib çš„ `getSupergroup` æ–¹æ³•æ¥è·å–è¶…çº§ç¾¤ç»„çš„åŸºæœ¬ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºå¦‚ä½•åœ¨æ’ä»¶ä¸­å®ç°è¿™ä¸€åŠŸèƒ½ï¼š

```ts title="SupergroupInfo.ts"
import { getSupergroup } from "@TDLib/function/supergroup.ts";

const supergroup = await getSupergroup(client, supergroup_id);
```

#### è¿”å›å†…å®¹

[supergroup Class Reference](https://core.telegram.org/tdlib/docs/classtd_1_1td__api_1_1supergroup.html)


# è·å–ç”¨æˆ·ä¿¡æ¯ (/docs/2.plugin/function/getUser)

<TypeTable
  type={{
  client: {
    description:
      'TDLib å®¢æˆ·ç«¯å®ä¾‹',
    type: 'Client',
  },
  user_id: {
    description: 'è¦è·å–ä¿¡æ¯çš„ç”¨æˆ· ID',
    type: 'number',
  },
}}
/>

#### è·å–ç”¨æˆ·ä¿¡æ¯

å¯ä»¥ä½¿ç”¨ TDLib çš„ `getUser` æ–¹æ³•æ¥è·å–ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºå¦‚ä½•åœ¨æ’ä»¶ä¸­å®ç°è¿™ä¸€åŠŸèƒ½ï¼š

```ts title="UserInfo.ts"
import { getUser } from "@TDLib/function/user.ts";

const user = await getUser(client, user_id);
```

#### è¿”å›å†…å®¹

[user Class Reference](https://core.telegram.org/tdlib/docs/classtd_1_1td__api_1_1user.html)


# è·å–ç”¨æˆ·çš„å®Œæ•´ä¿¡æ¯ (/docs/2.plugin/function/getUserFullInfo)

<TypeTable
  type={{
  client: {
    description:
      'TDLib å®¢æˆ·ç«¯å®ä¾‹',
    type: 'Client',
  },
  user_id: {
    description: 'è¦è·å–ä¿¡æ¯çš„ç”¨æˆ· ID',
    type: 'number',
  },
}}
/>

#### è·å–ç”¨æˆ·ä¿¡æ¯

å¯ä»¥ä½¿ç”¨ TDLib çš„ `getUserFullInfo` æ–¹æ³•æ¥è·å–ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºå¦‚ä½•åœ¨æ’ä»¶ä¸­å®ç°è¿™ä¸€åŠŸèƒ½ï¼š

```ts title="UserInfo.ts"
import { getUserFullInfo } from "@TDLib/function/user.ts";

const user = await getUserFullInfo(client, user_id);
```

#### è¿”å›å†…å®¹

[userFullInfo Class Reference](https://core.telegram.org/tdlib/docs/classtd_1_1td__api_1_1user_full_info.html)


# å°è£…å‡½æ•° (/docs/2.plugin/function)

## `@TDLib/function` é€ŸæŸ¥

é¡¹ç›®åœ¨ `src/TDLib/function` ä¸‹å°è£…äº†å¸¸è§æ“ä½œï¼Œå¯ç›´æ¥å¯¼å…¥ä½¿ç”¨ï¼š

### ç”¨æˆ· / èŠå¤© / æ¶ˆæ¯

* `getUser(client, user_id)`
* `getUserFullInfo(client, user_id)`
* `getChat(client, chat_id)`
* `getSupergroup(client, supergroup_id)` / `getSupergroupFullInfo`
* `getMessage(client, chat_id, message_id)`

```ts
import { getUser, getChat } from "@TDLib/function";

const user = await getUser(client, 123456);
const chat = await getChat(client, 987654);
```

### æ¶ˆæ¯å‘é€ä¸ç¼–è¾‘

* `sendMessage` / `sendMessageAlbum`
* `editMessageText` / `editMessageCaption` / `editMessageMedia`
* `deleteMessage`

```ts
import { sendMessage, editMessageText } from "@TDLib/function";

const msg = await sendMessage(client, chatId, { text: "Hello *world*" });
await editMessageText(client, chatId, msg.id, { text: "Edited text" });
```

### æƒé™ä¸ç®¡ç†

* `restrictUser`
* `setUserAsMember`
* `setUserRestricted`
* `banUser`
* `isMeAdmin` / `isUserAdmin`

### æ–‡ä»¶ä¸ä»£ç†

* `downloadFile`
* `getProxies` / `addProxy` / `removeProxy`
* `enableProxy` / `disableProxy`
* `pingProxy` / `testProxy` / `getProxyLink`

### å…¶ä»–å·¥å…·

* `answerCallbackQuery`
* `getLinkPreview`
* `getMessageLink` / `getMessageLinkInfo`
* `chatoruserMdown`

ç¤ºä¾‹ï¼š

```ts
import { sendMessage, getUser } from "@TDLib/function";

export default class MyPlugin extends Plugin {
  async onSomeEvent(update) {
    const user = await getUser(this.client, update.sender_user_id);
    await sendMessage(this.client, update.chat_id, {
      text: `Hello ${user.first_name}`,
    });
  }
}
```

> æç¤ºï¼šå°è£…å‡½æ•°å‡ºé”™æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¯·ä½¿ç”¨ `try/catch` å¤„ç†ã€‚
